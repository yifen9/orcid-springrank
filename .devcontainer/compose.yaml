services:
  orcid-springrank:
    image: ghcr.io/yifen9/orcid-springrank
    build:
      context: ..
      dockerfile: Dockerfile
    container_name: orcid-springrank
    working_dir: /workspace
    environment:
      - JULIA_DEPOT_PATH=/opt/julia-depot
      - JULIA_PROJECT=@.
      - JULIA_NUM_THREADS=auto
    volumes:
      - "..:/workspace"
      - "julia-depot:/opt/julia-depot"
      - "/mnt/e/data/orcid/source:/workspace/data/orcid/source"
    command: >
      bash -c "
        julia -e 'using Pkg; Pkg.instantiate(); Pkg.precompile()' &&
        just --version &&
        exec sleep infinity
      "
volumes:
  julia-depot:
